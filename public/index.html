<!-- <!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do List</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>To-Do List</h1>
        <input type="text" id="taskTitle" placeholder="Add a task">
        <button onclick="addTask()">Add Task</button>
        <ul id="taskList" class="task-list"></ul>
    </div>

    <script>
        function addTask() {
            const taskTitle = document.getElementById('taskTitle').value;
            if (!taskTitle) return;

            const taskList = document.getElementById('taskList');
            const taskItem = document.createElement('li');
            taskItem.className = 'task';
            taskItem.innerHTML = `
                ${taskTitle} - <span class="status">Pending</span>
                <button onclick="toggleTask(this)">Toggle</button>
                <button onclick="deleteTask(this)">Delete</button>
            `;

            taskList.appendChild(taskItem);
            document.getElementById('taskTitle').value = '';  // Limpar o campo ap칩s adicionar a tarefa
        }

        function toggleTask(button) {
            const taskItem = button.parentNode;
            const status = taskItem.querySelector('.status');
            if (status.textContent === 'Pending') {
                status.textContent = 'Complete';
                taskItem.classList.add('completed');
            } else {
                status.textContent = 'Pending';
                taskItem.classList.remove('completed');
            }
        }

        function deleteTask(button) {
            const taskItem = button.parentNode;
            taskItem.remove();
        }
    </script>


</body>
</html> -->


<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do List</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <h1>To-Do List</h1>
    <input type="text" id="taskTitle" placeholder="Add a task">
    <button onclick="addTask()">Add Task</button>
    <ul id="taskList" class="task-list"></ul>
</div>

<script>
    // Adicionar uma nova tarefa
    async function addTask() {
        const taskTitle = document.getElementById('taskTitle').value;
        if (!taskTitle) return;

        // Enviar a nova tarefa para o servidor usando fetch
        const response = await fetch('/tasks', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ title: taskTitle }),
        });

        if (response.ok) {
            const newTask = await response.json();
            addTaskToDOM(newTask);
            document.getElementById('taskTitle').value = '';  // Limpar o campo ap칩s adicionar a tarefa
        } else {
            console.error('Erro ao adicionar a tarefa:', response.statusText);
        }
    }

    // Adicionar a tarefa ao DOM (visualmente)
    function addTaskToDOM(task) {
        const taskList = document.getElementById('taskList');
        const taskItem = document.createElement('li');
        taskItem.className = 'task';
        taskItem.innerHTML = `
            ${task.title} - <span class="status">${task.status}</span>
            <button onclick="toggleTask(this, ${task.id})">Toggle</button>
            <button onclick="deleteTask(this, ${task.id})">Delete</button>
        `;
        taskList.appendChild(taskItem);
    }

    // Alternar o status da tarefa
    async function toggleTask(button, taskId) {
        const taskItem = button.parentNode;
        const status = taskItem.querySelector('.status').textContent === 'Pending' ? 'complete' : 'pending';

        // Atualizar o status no servidor
        const response = await fetch(`/tasks/${taskId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ status }),
        });

        const updatedTask = await response.json();
        taskItem.querySelector('.status').textContent = updatedTask.status === 'complete' ? 'Complete' : 'Pending';
    }

    // Remover a tarefa
    async function deleteTask(button, taskId) {
        const response = await fetch(`/tasks/${taskId}`, {
            method: 'DELETE',
        });

        if (response.ok) {
            const taskItem = button.parentNode;
            taskItem.remove();
        }
    }

    // Carregar todas as tarefas quando a p치gina for carregada
    async function loadTasks() {
        const response = await fetch('/tasks');
        const tasks = await response.json();

        tasks.forEach(task => addTaskToDOM(task));
    }

    // Carregar tarefas ao abrir a p치gina
    document.addEventListener('DOMContentLoaded', loadTasks);
</script>

</body>
</html>
